open Core
open Async
open Hardcaml
open C8.Global
open C8.Cpu_core

let pp v = Bits.to_int !v |> Int.to_string
let ppb v = Bits.to_string !v

let sim_set_write_ram sim (i : _ I.t) (o : _ O.t) addr data =
  i.program := Bits.of_int ~width:(Sized.size `Bit) 1;
  i.program_write_enable := Bits.of_int ~width:(Sized.size `Bit) 1;
  i.program_address := Bits.of_int ~width:(Sized.size `Address) addr;
  i.program_data := Bits.of_int ~width:(Sized.size `Byte) data;
  Cyclesim.cycle sim;
  Cyclesim.cycle sim;
  Cyclesim.cycle sim;
  Cyclesim.cycle sim;
  print_s [%message "" ~last_read:(pp o.program_read_data)]
;;

let _sim_read_addr sim (i : _ I.t) (o : _ O.t) addr =
  i.program := Bits.of_int ~width:(Sized.size `Bit) 1;
  i.program_write_enable := Bits.of_int ~width:(Sized.size `Bit) 0;
  i.program_address := Bits.of_int ~width:(Sized.size `Address) addr;
  Cyclesim.cycle sim;
  Cyclesim.cycle sim;
  Cyclesim.cycle sim;
  Cyclesim.cycle sim;
  print_s [%message "" ~last_read:(pp o.program_read_data)]
;;

let sim_cycle_not_programming sim (i : _ I.t) (o : _ O.t) =
  i.program := Bits.of_int ~width:1 0;
  Cyclesim.cycle sim;
  print_s
    [%message
      ""
        ~op:(ppb o.op)
        ~program_read_data:(pp o.program_read_data)
        ~program_read_address:(pp o.program_read_address)
        ~in_execute:(pp o.in_execute)
        ~executor_pc:(pp o.registers.pc)
        ~executor_i:(pp o.registers.i)
        ~executor_done:(pp o.registers.done_)
        ~executor_error:(pp o.registers.error)
        ~executor_registers:(List.map o.registers.registers ~f:pp : string list)]
;;

let test ~rom_file ~create =
  let module Simulator = Cyclesim.With_interface (I) (O) in
  let sim = Simulator.create create in
  let inputs : _ I.t = Cyclesim.inputs sim in
  let outputs : _ O.t = Cyclesim.outputs sim in
  (* Write the test rom to main memory *)
  String.iteri rom_file ~f:(fun i c ->
      sim_set_write_ram sim inputs outputs i (Char.to_int c));
  (* Simulate the program we just wrote running for 100 cycles *)
  Sequence.range 0 100
  |> Sequence.iter ~f:(fun _ -> sim_cycle_not_programming sim inputs outputs);
  ()
;;

let%expect_test "program memory" =
  let%bind rom_file =
    Reader.file_contents "../test_rom/Maze (alt) [David Winter, 199x].ch8"
  in
  test ~rom_file ~create;
  [%expect
    {|
    (last_read 96)
    (last_read 0)
    (last_read 97)
    (last_read 0)
    (last_read 162)
    (last_read 34)
    (last_read 194)
    (last_read 1)
    (last_read 50)
    (last_read 1)
    (last_read 162)
    (last_read 30)
    (last_read 208)
    (last_read 20)
    (last_read 112)
    (last_read 4)
    (last_read 48)
    (last_read 64)
    (last_read 18)
    (last_read 4)
    (last_read 96)
    (last_read 0)
    (last_read 113)
    (last_read 4)
    (last_read 49)
    (last_read 32)
    (last_read 18)
    (last_read 4)
    (last_read 18)
    (last_read 28)
    (last_read 128)
    (last_read 64)
    (last_read 32)
    (last_read 16)
    (last_read 32)
    (last_read 64)
    (last_read 128)
    (last_read 16)
    ((op 0000000000000000) (program_read_data 96) (program_read_address 0)
     (in_execute 0) (executor_pc 0) (executor_i 0) (executor_done 0)
     (executor_error 0) (executor_registers (0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 0000000000000000) (program_read_data 96) (program_read_address 0)
     (in_execute 0) (executor_pc 0) (executor_i 0) (executor_done 0)
     (executor_error 0) (executor_registers (0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 0000000000000000) (program_read_data 96) (program_read_address 1)
     (in_execute 0) (executor_pc 0) (executor_i 0) (executor_done 0)
     (executor_error 0) (executor_registers (0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 0000000000000000) (program_read_data 0) (program_read_address 0)
     (in_execute 0) (executor_pc 0) (executor_i 0) (executor_done 0)
     (executor_error 0) (executor_registers (0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 0110000000000000) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 0) (executor_i 0) (executor_done 0)
     (executor_error 0) (executor_registers (0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 0110000000000000) (program_read_data 96) (program_read_address 2)
     (in_execute 0) (executor_pc 2) (executor_i 0) (executor_done 1)
     (executor_error 0) (executor_registers (0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 0110000000000000) (program_read_data 97) (program_read_address 0)
     (in_execute 0) (executor_pc 2) (executor_i 0) (executor_done 0)
     (executor_error 0) (executor_registers (0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 0110000000000000) (program_read_data 96) (program_read_address 3)
     (in_execute 0) (executor_pc 2) (executor_i 0) (executor_done 0)
     (executor_error 0) (executor_registers (0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 0110000000000000) (program_read_data 0) (program_read_address 0)
     (in_execute 0) (executor_pc 2) (executor_i 0) (executor_done 0)
     (executor_error 0) (executor_registers (0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 0110000100000000) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 2) (executor_i 0) (executor_done 0)
     (executor_error 0) (executor_registers (0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 0110000100000000) (program_read_data 96) (program_read_address 4)
     (in_execute 0) (executor_pc 4) (executor_i 0) (executor_done 1)
     (executor_error 0) (executor_registers (0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 0110000100000000) (program_read_data 162) (program_read_address 0)
     (in_execute 0) (executor_pc 4) (executor_i 0) (executor_done 0)
     (executor_error 0) (executor_registers (0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 0110000100000000) (program_read_data 96) (program_read_address 5)
     (in_execute 0) (executor_pc 4) (executor_i 0) (executor_done 0)
     (executor_error 0) (executor_registers (0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 0110000100000000) (program_read_data 34) (program_read_address 0)
     (in_execute 0) (executor_pc 4) (executor_i 0) (executor_done 0)
     (executor_error 0) (executor_registers (0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1010001000000000) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 4) (executor_i 0) (executor_done 0)
     (executor_error 0) (executor_registers (0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1010001000000000) (program_read_data 96) (program_read_address 6)
     (in_execute 0) (executor_pc 6) (executor_i 512) (executor_done 1)
     (executor_error 0) (executor_registers (0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1010001000000000) (program_read_data 194) (program_read_address 0)
     (in_execute 0) (executor_pc 6) (executor_i 512) (executor_done 0)
     (executor_error 0) (executor_registers (0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1010001000000000) (program_read_data 96) (program_read_address 7)
     (in_execute 0) (executor_pc 6) (executor_i 512) (executor_done 0)
     (executor_error 0) (executor_registers (0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1010001000000000) (program_read_data 1) (program_read_address 0)
     (in_execute 0) (executor_pc 6) (executor_i 512) (executor_done 0)
     (executor_error 0) (executor_registers (0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1100001000100010) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 6) (executor_i 512) (executor_done 0)
     (executor_error 0) (executor_registers (0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1100001000100010) (program_read_data 96) (program_read_address 8)
     (in_execute 0) (executor_pc 8) (executor_i 512) (executor_done 1)
     (executor_error 0) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1100001000100010) (program_read_data 50) (program_read_address 0)
     (in_execute 0) (executor_pc 8) (executor_i 512) (executor_done 0)
     (executor_error 0) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1100001000100010) (program_read_data 96) (program_read_address 9)
     (in_execute 0) (executor_pc 8) (executor_i 512) (executor_done 0)
     (executor_error 0) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1100001000100010) (program_read_data 1) (program_read_address 0)
     (in_execute 0) (executor_pc 8) (executor_i 512) (executor_done 0)
     (executor_error 0) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 0011001000000001) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 8) (executor_i 512) (executor_done 0)
     (executor_error 0) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 0011001000000001) (program_read_data 96) (program_read_address 10)
     (in_execute 0) (executor_pc 10) (executor_i 512) (executor_done 1)
     (executor_error 0) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 0011001000000001) (program_read_data 162) (program_read_address 0)
     (in_execute 0) (executor_pc 10) (executor_i 512) (executor_done 0)
     (executor_error 0) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 0011001000000001) (program_read_data 96) (program_read_address 11)
     (in_execute 0) (executor_pc 10) (executor_i 512) (executor_done 0)
     (executor_error 0) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 0011001000000001) (program_read_data 30) (program_read_address 0)
     (in_execute 0) (executor_pc 10) (executor_i 512) (executor_done 0)
     (executor_error 0) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1010001000000001) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 10) (executor_i 512) (executor_done 0)
     (executor_error 0) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1010001000000001) (program_read_data 96) (program_read_address 12)
     (in_execute 0) (executor_pc 12) (executor_i 513) (executor_done 1)
     (executor_error 0) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1010001000000001) (program_read_data 208) (program_read_address 0)
     (in_execute 0) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 0) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1010001000000001) (program_read_data 96) (program_read_address 13)
     (in_execute 0) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 0) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1010001000000001) (program_read_data 20) (program_read_address 0)
     (in_execute 0) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 0) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 0) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0)))
    ((op 1101000000011110) (program_read_data 96) (program_read_address 0)
     (in_execute 1) (executor_pc 12) (executor_i 513) (executor_done 0)
     (executor_error 1) (executor_registers (0 0 162 0 0 0 0 0 0 0 0 0 0 0 0 0))) |}];
  return ()
;;
